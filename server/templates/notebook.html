{% extends "base.html" %}
{% block head %}
    <script src="{{ static_url('notebook.js') }}"></script>
{% end %}
{% block toolbar %}
    {% include "toolbar.html" %}
{% end %}
{% block content %}
    <div id="editor-container">
        <div class="header">
            <h2>{{ title }}</h2>
            <a href="/?path={{ current_path }}">back to directory</a>
        </div>
        <div class="notebook-metadata">
            <div class="kernel-info">
                Kernel: {{ kernelspec['display_name'] }} ({{ language_info['name'] }} {{ language_info['version'] }})
            </div>
            <div class="format-info">Format: {{ nbformat }}.{{ nbformat_minor }}</div>
            {% if last_checkpoint %}
                <div class="checkpoint-info">
                    Last Checkpoint: {{ last_checkpoint['filename'] }}
                    ({{ last_checkpoint['modified'] }})
                </div>
            {% end %}
            <div class="codemirror-info">
                CodeMirror Mode: {{ language_info['codemirror_mode']['name'] }}
                | MIME: {{ language_info['mimetype'] }}
                | Ext: {{ language_info['file_extension'] }}
            </div>
        </div>
        <div class="notebook">
            {% for cell in cells %}
                {% if cell['cell_type'] == 'code' %}
                    <!-- CODE CELL -->
                    <div class="cell code-cell">
                        <div class="cell-toolbar">
                            <button class="run-btn">Run</button>
                            <button class="move-up-btn">▲</button>
                            <button class="move-down-btn">▼</button>
                            <button class="duplicate-btn">Duplicate</button>
                            <button class="delete-btn">Delete</button>
                        </div>
                        <!-- Input area -->
                        <div class="input-area">
                            <span class="execution-count">[{{ cell['execution_count'] if cell['execution_count'] else '' }}]</span>
                            <pre class="input-code">
                                <code>{{ '\n'.join(cell['source']) }}</code>
                            </pre>
                        </div>
                        <!-- Output area -->
                        <div class="output-area">
                            {% if cell['outputs'] %}
                                {% for output in cell['outputs'] %}
                                    <pre class="output-code">
                                        <code>{{ '\n'.join(output['text']) if output['text'] else '' }}</code>
                                    </pre>
                                {% end %}
                            {% else %}
                                <pre class="output-code"><code></code></pre>
                            {% end %}
                        </div>
                    </div>
                {% else %}
                    <!-- MARKDOWN CELL -->
                    <div class="cell markdown-cell">
                        <div class="cell-toolbar">
                            <button class="edit-markdown-btn">Edit</button>
                            <button class="move-up-btn">▲</button>
                            <button class="move-down-btn">▼</button>
                            <button class="duplicate-btn">Duplicate</button>
                            <button class="delete-btn">Delete</button>
                        </div>
                        <!-- Rendered markdown area -->
                        <div class="rendered-markdown">{{ '\n'.join(cell['source']) }}</div>
                        <!-- Hidden text area for editing markdown -->
                        <textarea class="markdown-editor"></textarea>
                    </div>
                {% end %}
            {% end %}
        </div>
    </div>
{% end %}
